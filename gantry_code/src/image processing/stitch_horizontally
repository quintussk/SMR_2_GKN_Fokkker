import cv2
import numpy as np
import os

# Directory containing the images
image_dir = './images'

# Get the list of image files in the directory
image_files = [file for file in os.listdir(image_dir) if file.endswith(('.png', '.jpg', '.jpeg'))]

if len(image_files) < 2:
    print("Need at least two images to stitch.")
    exit()

# Load images
images = []
for file in image_files:
    image_path = os.path.join(image_dir, file)
    img = cv2.imread(image_path)
    if img is not None:
        images.append(img)
    else:
        print(f"Error loading {file}")

# Check if we have at least two valid images
if len(images) < 2:
    print("Insufficient valid images to create a collage.")
    exit()

# Stitch images horizontally
try:
    stitched_image = np.hstack(images)
    
    # Show the stitched image
    cv2.imshow("Stitched Image", stitched_image)
    cv2.waitKey(0)

    # Generate a unique name for the stitched image
    name = 1
    while os.path.exists(os.path.join(image_dir, f'stitched_image{name}.jpg')):
        name += 1
    output_path = os.path.join(image_dir, f'stitched_image{name}.jpg')

    # # Save the stitched image
    # cv2.imwrite(output_path, stitched_image)
    # print(f"Stitched image saved at {output_path}")

    # Delete the original images
    for file in image_files:
        os.remove(os.path.join(image_dir, file))
        print(f"Deleted {file}")

except Exception as e:
    print(f"Error stitching images: {e}")

finally:
    cv2.destroyAllWindows()
